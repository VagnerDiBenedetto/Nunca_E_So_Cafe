<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro</title>
    <link rel = "icon" href="Imagens/LogoFundo.png" type="image/x-icon">
    <link rel="stylesheet" href="Style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500&family=Playfair+Display:wght@600&family=Rowdies:wght@300&display=swap" rel="stylesheet">
</head>
<body>

    <div class="header">
        <div class="login">
            <a href="../Login/Index.html">Login</a>
        </div>
        <div class="container">
            <h1 class="logo"><a href="../Pagina_Inicial/Index.html"><img src="Imagens/Logo.png" alt="Logo">Nunca É Só Café</a></h1>
            <div class="barraNavegacao">
                <a href="../História/Index.html">História</a>
                <a href="../Processos/Index.html">Processos</a>
                <a href="../Projeto/Index.html">Projeto</a>
            </div>
        </div>
    </div>
    <div class="body">
        <br>
        <br>
        <br>
        <div class="fundo">
            <br>
            <div class="container">
                <div>
                    <br>
                    <br>
                    <br>
                    <h2>Dados Pessoais</h2>
                    <br>
                    <br>
                    <br>
                </div>
                <div class="fileiraCadastro">
                    <div>
                        <span>
                            E-mail:<br>
                            <input oninput="validacaoDadosPessoais()" type="text" id="inputEmail"><br>
                        </span>
                        <br>
                        <span>
                            Senha:<br>
                            <input oninput="validacaoDadosPessoais()" type="text" id="inputSenha"><br>
                        </span>
                        <br>
                        <span>
                            Confirmação de Senha:<br>
                            <input oninput="validacaoDadosPessoais()" type="text" id="inputConfirmaSenha"><br>
                        </span>
                        <br>
                    </div>
                    <div>
                        <span>
                            Nome:<br>
                            <input oninput="validacaoDadosPessoais()" type="text" id="inputNome"><br>
                        </span>
                        <br>
                        <span>
                            Data de Nascimento:<br>
                            <input oninput="validacaoDadosPessoais()" type="text" id="inputData_de_Nascimento"><br>
                        </span>
                        <br>
                        <span>
                            Numero de telefone:<br>
                            <input oninput="validacaoDadosPessoais()" type="text" id="inputNumero_de_Telefone"><br>
                        </span>
                        <br>
                    </div>
                </div>
                <br>
                <br>
                <div id="divValidacaoDadosPessoais"></div> 
                <br>
                <div>
                    <br>
                    <br>
                    <br>
                    <h2>Endereço</h2>
                    <br>
                    <br>
                    <br>
                </div>
                <div class="fileiraCadastro">
                    <div>
                        <span>
                            Cep:<br>
                            <input onkeyup="validacaoEndereco()" type="text" id="inputCep"><br>
                        </span>
                        <br>
                        <span>
                            Estado:<br>
                            <input onkeyup="validacaoEndereco()" type="text" id="inputEstado"><br>
                        </span>
                        <br>
                        <span>
                            Cidade:<br>
                            <input onkeyup="validacaoEndereco()" type="text" id="inputCidade"><br>
                        </span>
                        <br>
                    </div>
                    <div>
                        <span>
                            Rua:<br>
                            <input onkeyup="validacaoEndereco()" type="text" id="inputRua"><br>
                        </span>
                        <br>
                        <span>
                            Numero:<br>
                            <input type="text" id="inputNumero"><br>
                        </span>
                        <br>
                        <span>
                            Referencia:<br>
                            <input type="text" id="inputReferencia"><br>
                        </span>
                        <br>
                    </div>
                </div>  
                <br>
                <br>
                <div id="divValidacaoEndereco"></div> 
                <br>
                <br>
                <br>
                <div>
                    <button onclick="cadastro()">Cadastro</button>
                </div>
                <br>
                <br>
                <br>
                <br>
                <br>
                <div class="anuncio">
                    <img src="Imagens/Anuncio].png" alt="">
                </div>
                <br>
                <br>
                <br>
                <br>
                <br>
            </div>
        </div>
        <br>
        <br>
        <br>
        <div class="footer">
            <div class="link">
                <div>
                <a href="../Pagina Inicial/Index.html">Sobre o Café</a>
                </div>
                <div>
                <a href="../História/Index.html">História do café</a>
                </div>
                <div>
                <a href="../Processos/Index.html">Processos</a>
                </div>
                <div>
                <a href="../Projeto/Index.html">Sobre o Projeto</a>
                </div>
            </div>
            <div class="link">
                <div>
                <a href="">Instagram</a>
                </div>
                <div>
                <a href="">Linkedin</a>
                </div>
                <div>
                <a href="">GitHub</a>
                </div>
            </div>
            <div class="link">
                <div>
                <a href="">O Monte Video</a>
                </div>
                <div>
                <a href="">Lampada Nerd</a>
                </div>
                <div>
                <a href="">Lampcast Podcast</a>
                </div>
            </div>
        </div>
        <br>
        <br>
        <br>
    </div>
    
</body>
</html>

<script>

    function validacaoDadosPessoais(){          
        var email = inputEmail.value;
        var senha = inputSenha.value;
        var tamanhoSenha = senha.length;
        var confirmaSenha = inputConfirmaSenha.value;
        var nome = inputNome.value;
        var numeroTelefone = inputNumero_de_Telefone.value;
        var dtNascimento =inputData_de_Nascimento.value;
         
        var validacaoEspecial =senha.indexOf("!") >= 0 ||
            senha.indexOf("@") >= 0 ||
            senha.indexOf("#") >= 0 ||
            senha.indexOf("$") >= 0 ||
            senha.indexOf("%") >= 0 ||
            senha.indexOf("¨") >= 0 ||
            senha.indexOf("&") >= 0 ||
            senha.indexOf("*") >= 0 ||
            senha.indexOf("(") >= 0 ||
            senha.indexOf(")") >= 0 ||
            senha.indexOf("-") >= 0 ||
            senha.indexOf("_") >= 0 ||
            senha.indexOf("+") >= 0 ||
            senha.indexOf("=") >= 0 ||
            senha.indexOf("§") >= 0 ||
            senha.indexOf('"') >= 0 ||
            senha.indexOf("'") >= 0 ||
            senha.indexOf(",") >= 0 ||
            senha.indexOf("<") >= 0 ||
            senha.indexOf(".") >= 0 ||
            senha.indexOf(">") >= 0 ||
            senha.indexOf(":") >= 0 ||
            senha.indexOf(":") >= 0 ||
            senha.indexOf("/") >= 0 ||
            senha.indexOf("?") >= 0 ||
            senha.indexOf("°") >= 0 ||
            senha.indexOf("º") >= 0 ||
            senha.indexOf("]") >= 0 ||
            senha.indexOf("}") >= 0 ||
            senha.indexOf("ª") >= 0 ||
            senha.indexOf("[") >= 0 ||
            senha.indexOf("{") >= 0 ||
            senha.indexOf("%") >= 0;

        var validacaoPeloMenosUmNumero = 
            senha.indexOf(0) >= 0 ||
            senha.indexOf(1) >= 0 ||
            senha.indexOf(2) >= 0 ||
            senha.indexOf(3) >= 0 ||
            senha.indexOf(4) >= 0 ||
            senha.indexOf(5) >= 0 ||
            senha.indexOf(6) >= 0 ||
            senha.indexOf(7) >= 0 ||
            senha.indexOf(8) >= 0 ||
            senha.indexOf(9) >= 0;

        var textoValidacao = "";

        if (email.indexOf("@") < 0){
            textoValidacao += `<span style="color: red";>* O E-mail deve conter um @.</span><br>`;
        }

        if(tamanhoSenha < 8){
            textoValidacao += `<span style="color: red";>* A Senha deve conter ao menos 8 caracteres.</span><br>`;
        }else if (senha == senha.toLowerCase() || senha == senha.toUpperCase()){
            textoValidacao += `<span style="color: red";>* A Senha deve ter ao menos uma letra maiuscula e uma letra misucaula.</span><br>`;
        }else if (validacaoEspecial == false){
            textoValidacao += `<span style="color: red";>* A Senha deve conter ao menos 1 caracter especial.</span><br>`;
        }else if (validacaoPeloMenosUmNumero == false){
            textoValidacao += `<span style="color: red";>* A Senha deve conter ao menos 1 numero.</span><br>`;
        }

        if (confirmaSenha != senha){
            textoValidacao += `<span style="color: red";>* As Senhas devem ser iguais.</span><br>`;
        }

        for (var i = 0; i < numeroTelefone.length; i++){
            if (numeroTelefone[i] != 0 && numeroTelefone[i] != 1 && numeroTelefone[i] != 2 && numeroTelefone[i] != 3 && numeroTelefone[i] != 4 && numeroTelefone[i] != 5 && numeroTelefone[i] != 6 && numeroTelefone[i] != 7 && numeroTelefone[i] != 8 && numeroTelefone[i] != 9){
                textoValidacao += `<span style="color: red";>* O Telefone deve conter apenas numeros.</span><br>`;
                break;
            }
        }

        divValidacaoDadosPessoais.innerHTML = textoValidacao;
    }

    function validacaoEndereco(){
        var cep = inputCep.value;
        var textoValidacao;

        for (var i = 0; i < cep.length; i++){
            if (cep[i] != 0 && cep[i] != 1 && cep[i] != 2 && cep[i] != 3 && cep[i] != 4 && cep[i] != 5 && cep[i] != 6 && cep[i] != 7 && cep[i] != 8 && cep[i] != 9){
                textoValidacao += `<span style="color: red";>* O CEP deve conter apenas numeros.</span><br>`;
                break;
            }
        }

        divValidacaoEndereco.innerHTML = textoValidacao;
    }

    
    function cadastro(){          
        var email = inputEmail.value;
        var senha = inputSenha.value;
        var tamanhoSenha = senha.length;
        var confirmaSenha = inputConfirmaSenha.value;
        var nome = inputNome.value;
        var telefone = inputNumero_de_Telefone.value;
        var cep = inputCep.value;
        var tamanhoCep = cep.length;
        var estado = inputEstado.value;
        var cidade = inputCidade.value;
        var rua = inputRua.value;
        var numero = inputNumero.value;
        var referencia = inputReferencia.value;
        var dtNascimento =inputData_de_Nascimento.value;
 
        var validacaoEspecial =senha.indexOf("!") >= 0 ||
        senha.indexOf("@") >= 0 ||
        senha.indexOf("#") >= 0 ||
        senha.indexOf("$") >= 0 ||
        senha.indexOf("%") >= 0 ||
        senha.indexOf("¨") >= 0 ||
        senha.indexOf("&") >= 0 ||
        senha.indexOf("*") >= 0 ||
        senha.indexOf("(") >= 0 ||
        senha.indexOf(")") >= 0 ||
        senha.indexOf("-") >= 0 ||
        senha.indexOf("_") >= 0 ||
        senha.indexOf("+") >= 0 ||
        senha.indexOf("=") >= 0 ||
        senha.indexOf("§") >= 0 ||
        senha.indexOf('"') >= 0 ||
        senha.indexOf("'") >= 0 ||
        senha.indexOf(",") >= 0 ||
        senha.indexOf("<") >= 0 ||
        senha.indexOf(".") >= 0 ||
        senha.indexOf(">") >= 0 ||
        senha.indexOf(":") >= 0 ||
        senha.indexOf(":") >= 0 ||
        senha.indexOf("/") >= 0 ||
        senha.indexOf("?") >= 0 ||
        senha.indexOf("°") >= 0 ||
        senha.indexOf("º") >= 0 ||
        senha.indexOf("]") >= 0 ||
        senha.indexOf("}") >= 0 ||
        senha.indexOf("ª") >= 0 ||
        senha.indexOf("[") >= 0 ||
        senha.indexOf("{") >= 0 ||
        senha.indexOf("%") >= 0;

        var validacaoNumero = 
        senha.indexOf(0) >= 0 ||
        senha.indexOf(1) >= 0 ||
        senha.indexOf(2) >= 0 ||
        senha.indexOf(3) >= 0 ||
        senha.indexOf(4) >= 0 ||
        senha.indexOf(5) >= 0 ||
        senha.indexOf(6) >= 0 ||
        senha.indexOf(7) >= 0 ||
        senha.indexOf(8) >= 0 ||
        senha.indexOf(9) >= 0;


        var somaValidados = 0;

        if (email.indexOf("@") >= 0){
            somaValidados ++;
        }

        if(tamanhoSenha >= 8 && senha != senha.toLowerCase() && senha != senha.toUpperCase() && validacaoEspecial == true && validacaoNumero == true){
            somaValidados ++;
        }

        if (confirmaSenha == senha){
            somaValidados ++;
        }

        if (tamanhoCep == 8){
            somaValidados ++;
        }
        
        if (estado != ""){
            somaValidados ++;
        }

        if (cidade != ""){
            somaValidados ++;
        }

        if (nome != ""){
            somaValidados ++;
        }

        if (rua != ""){
            somaValidados ++;
        }

        if (numero != ""){
            somaValidados ++;
        }
        if(dtNascimento != ""){
            somaValidados ++;
        }

        if (telefone.length == 11){
            somaValidados ++;
        }

        if (somaValidados == 11){
                    
            // Enviando o valor da nova input
            fetch("/usuarios/cadastrar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                cepServer: cep,
                estadoServer: estado,
                cidadeServer: cidade,
                ruaServer: rua,
                numeroServer: numero,
                referenciaServer: referencia,
                nomeServer: nome,
                dtNascimentoServer: dtNascimento,
                telefoneServer: telefone,
                emailServer: email,
                senhaServer: senha
            }),
            })
            .then(function (resposta) {
                console.log("resposta: ", resposta);

                if (resposta.ok) {
                console.log ("Cadastro realizado com sucesso! Redirecionando para tela de Login...");

                setTimeout(() => {
                    window.location = "../Login/Index.html";
                }, "2000");

                } else {
                throw "Houve um erro ao tentar realizar o cadastro!";
                }
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });

            return false;

        }else{
            alert("Todos os campos devem ser preenchidos.")
        }
    }

</script>